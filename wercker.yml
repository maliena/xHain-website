box: debian

build:
  steps:
    - arjen/hugo-build:
        version: "0.17"
        config: config.toml
        dev_flags: -D -F
        prod_branches: master

deploy:
  steps:
    - install-packages:
        packages: rsync ssh-client openssh-client ruby

    - add-ssh-key:
        keyname: xhainDeploy

    - add-to-known_hosts:
        hostname: acorn.x-hain.de

    - sjoerdmulder/rsync-deploy@0.1.0:
        host: acorn.x-hain.de
        directory: webroot
        sshkey: $xhainDeploy
        user: deploy
        source: public/

  after-steps:
     - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
        notify_on: "failed"